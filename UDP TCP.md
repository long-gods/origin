UDP用户数据报协议

是无连接的，尽最大可能交付，没有拥塞控制，面向报文（对于应用程序传下来的报文不合并也不拆分，只是添加UDP首部），支持一对一，一对多，多对多的交互通信。

TCP

是面向连接的，提供可靠交付，有流量控制，拥塞控制，提供全双工通信，面向字节流（把应用层传下来的报文看成字节流，把字节流组织成大小不同的数据块），每一条TCP连接只能是点对点

TCP首部：

序号：用于对字节流进行编号，例如序号为301，表示第一个字节的编号为301，如果携带数据长度为100字节，那么下一个报文段的序号应为401.

确认号：期望收到的下个报文段的序号。如B正确收到A发送来的一个报文段，序号为501，携带数据长度为200字节，因此B期望下一个报文段的序号为701，B发送A的确认报文段中确认号就为701.

数据偏移：指的是数据部分距离报文段起始处的偏移量，实际上指的是首部的长度。

**控制位：**八位从左到右分别是 CWR，ECE，URG，ACK，PSH，RST，SYN，FIN。

**CWR：**CWR 标志与后面的 ECE 标志都用于 IP 首部的 ECN 字段，ECE 标志为 1 时，则通知对方已将拥塞窗口缩小；

**ECE：**若其值为 1 则会通知对方，从对方到这边的网络有阻塞。在收到数据包的 IP 首部中 ECN 为 1 时将 TCP 首部中的 ECE 设为 1；

**URG：**该位设为 1，表示包中有需要紧急处理的数据，对于需要紧急处理的数据，与后面的紧急指针有关；

**ACK：**该位设为 1，确认应答的字段有效，TCP规定除了最初建立连接时的 SYN 包之外该位必须设为 1；

**PSH：**该位设为 1，表示需要将收到的数据立刻传给上层应用协议，若设为 0，则先将数据进行缓存；

**RST：**该位设为 1，表示 TCP 连接出现异常必须强制断开连接；

**SYN：**用于建立连接，该位设为 1，表示希望建立连接，并在其序列号的字段进行序列号初值设定；

**FIN：**该位设为 1，表示今后不再有数据发送，希望断开连接。当通信结束希望断开连接时，通信双方的主机之间就可以相互交换 FIN 位置为 1 的 TCP 段。

**为什么建立连接是三次握手，而关闭连接是四次**

1，TCP连接是双向传输的对等的模式，就是说双方都可以向对方发送或接收数据。当有一方要关闭连接时，会发送指令告知对方，我要关闭连接了。

**2，这时对方会回一个ACK，此时一个方向的连接关闭。但是另一个方向仍然可以继续传输数据，也就是说服务端收到客户端的FIN标识，就知道客户端想要断开这次连接了，但是，服务端呢，还是想要发送数据，等到发送完所有数据后，服务端发送一个FIN来关闭此连接。接收方发送ACK确认关闭连接。**

注意：接收到FIN报文的一方只能回复一个ACK，它是无法马上返回一个FIN报文段的，因为结束数据传输的指令是上层应用层给出的，我只是一个“搬运工”，我无法了解上层的意志“。

3，客户端发送FIN连接释放的报文之后，服务器收到了这个报文，就进入的CLOSE_WAIT状态。这个状态是为了让服务器发送还未传送完毕的数据，传送完毕之后，服务器会发送FIN连接释放报文。

4，因为服务端在LISTEN状态下，收到建立请求的SYN报文后把ACK和SYN放在一个报文里发送给客户端。而关闭连接时，当收到对方的FIN报文时，仅仅表示对方不在发送数据了但是还能接收数据，己方是否现在关闭发送数据通道，需要上层应用来决定，因此，己方ACK和FIN一般都会分开发。

TIME_WAIT

